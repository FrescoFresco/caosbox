# .github/workflows/firebase-hosting.yml
name: Build & Deploy Flutter Web → Firebase Hosting
on:
  push:
    branches: [ main ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      # ---------- 1. Flutter ----------
      - uses: subosito/flutter-action@v2
        with:
          channel: stable            # 3.32.8 hoy
          cache: true

      - name: 📦 Pub get
        run: flutter pub get

      # ---------- 2. Build ----------
      - name: 🏗️  Build web (release)
        run: flutter build web --release --base-href=/

      # Debug opcional: muestra que index.html existe
      - name: 🕵️  List build output
        run: ls -R build/web | head -n 20

      # ---------- 3. Deploy ----------
      - name: 🚀  Deploy to Firebase Hosting (live)
        uses: FirebaseExtended/action-hosting-deploy@v0.9.0
        with:
          repoToken:               ${{ secrets.GITHUB_TOKEN }}
          firebaseServiceAccount:  ${{ secrets.FIREBASE_SA }}
          projectId:               caosbox-ef75b
          channelId:               live            # producción
