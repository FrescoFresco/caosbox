<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta content="IE=Edge" http-equiv="X-UA-Compatible" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CaosBox</title>

    <!-- üëá IMPORTANTE para GitHub Pages (Flutter lo reescribe en build) -->
    <base href="$FLUTTER_BASE_HREF">

    <!-- Iconos/manifest opcionales (si ya los tienes, deja los tuyos) -->
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#ffffff" />

    <!-- Carga del loader de Flutter -->
    <script defer src="flutter.js"></script>

    <!-- Evita registrar SW (usamos --pwa-strategy=none) -->
    <script>
      // En builds PWA Flutter define esto; lo dejamos expl√≠cito a null para evitar 404.
      const serviceWorkerVersion = null;
    </script>
  </head>
  <body>
    <!-- Contenedor de la app -->
    <div id="loading" style="font: 16px system-ui, -apple-system, Segoe UI, Roboto, Arial; padding: 24px; color:#555;">
      Cargando‚Ä¶
    </div>

    <script>
      // Usamos la API cl√°sica (loadEntrypoint) ‚Äî ver√°s un warning deprecado, pero funciona estable.
      window.addEventListener('load', function () {
        if (!window._flutter) {
          document.body.innerHTML = '<pre>Fallo cargando flutter.js</pre>';
          return;
        }
        window._flutter.loader
          .loadEntrypoint({
            onEntrypointLoaded: function (engineInitializer) {
              engineInitializer.initializeEngine().then(function (appRunner) {
                document.getElementById('loading')?.remove();
                appRunner.runApp();
              });
            },
          })
          .catch((e) => {
            document.body.innerHTML =
              '<pre style="white-space:pre-wrap;color:#b00">Error arrancando la app\n\n' +
              String(e && (e.stack || e.message || e)) +
              '</pre>';
          });
      });
    </script>
  </body>
</html>
