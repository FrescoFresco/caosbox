<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      content="IE=Edge"
      http-equiv="X-UA-Compatible"
    />
    <meta
      name="description"
      content="CaosBox • beta"
    />

    <!-- MUY IMPORTANTE: base para GitHub Pages / dominio raíz -->
    <base href="/" />

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-title" content="CaosBox" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>CaosBox • beta</title>
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" type="image/png" href="icons/Icon-192.png" />

    <style>
      html,body { height:100%; margin:0; background:#111; }
      #loader {
        position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
        color:#ccc; font-family: system-ui, Arial, sans-serif;
      }
      #err { position:fixed; bottom:12px; left:12px; right:12px; background:#222; color:#f55;
        border:1px solid #444; padding:12px; border-radius:8px; font:14px/1.3 system-ui, Arial, sans-serif; display:none;}
      code{ color:#f99 }
    </style>
    <script defer src="flutter.js"></script>
  </head>
  <body>
    <div id="loader">Cargando CaosBox…</div>
    <div id="err"></div>

    <script>
      // Si algo revienta antes de Flutter, lo mostramos.
      const showErr = (msg) => {
        const e = document.getElementById('err');
        e.innerHTML = "<b>Error arrancando la app</b><br>Detalles:<br><code>"+msg+"</code>";
        e.style.display = 'block';
      };
      window.addEventListener('error', (ev) => showErr(ev.message));
      window.addEventListener('unhandledrejection', (ev) => showErr(ev.reason && ev.reason.message ? ev.reason.message : String(ev.reason)));

      // API nueva del loader
      window.addEventListener('load', async () => {
        try {
          const app = await _flutter.loader.load({ serviceWorker: { serviceWorkerVersion: null } }); // sin SW
          await app.run();
          document.getElementById('loader').remove();
        } catch (e) {
          showErr(e?.message ?? String(e));
        }
      });
    </script>
  </body>
</html>
